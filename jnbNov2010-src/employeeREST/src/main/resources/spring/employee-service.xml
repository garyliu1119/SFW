<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:jdbc="http://www.springframework.org/schema/jdbc"
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans.xsd 
    http://www.springframework.org/schema/context 
    http://www.springframework.org/schema/beans/spring-context.xsd
    http://www.springframework.org/schema/aop
    http://www.springframework.org/schema/aop/spring-aop.xsd
    http://www.springframework.org/schema/tx
    http://www.springframework.org/schema/tx/spring-tx.xsd  
    http://www.springframework.org/schema/jdbc 
    http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd">


<jdbc:embedded-database id="dataSource">
    <jdbc:script location="classpath:/sql/employees.sql"/>   
</jdbc:embedded-database>

<bean id="hibernateSessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
   <property name="dataSource" ref="dataSource" />
   <property name="mappingLocations">
    <list>
        <value>classpath:/hibernate/employee.hbm.xml</value>
    </list>
   </property>
   <property name="hibernateProperties">
        <props>
            <prop key="hibernate.dialect">org.hibernate.dialect.HSQLDialect</prop>
        </props>
   </property>
</bean>

<bean id="transactionManager" 
    class="org.springframework.orm.hibernate3.HibernateTransactionManager" p:sessionFactory-ref="hibernateSessionFactory" />

<bean id="employeeDao" class="com.ociweb.corespring.examples.employee.dao.EmployeeHibernateDao" p:sessionFactory-ref="hibernateSessionFactory"/>

<bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />

<bean id="employeeService" class="com.ociweb.corespring.examples.employee.service.DefaultEmployeeService" p:dao-ref="employeeDao"/>

<tx:advice id="txAdvice" transaction-manager="transactionManager">
    <tx:attributes>
      <tx:method name="get*" read-only="true"/>
      <tx:method name="*"/>
    </tx:attributes>
 </tx:advice>

<aop:config>
    <aop:pointcut id="serviceLayer" expression="execution(* com.ociweb.corespring..*Service.*(..))" />
    <aop:advisor advice-ref="txAdvice" pointcut-ref="serviceLayer"/>
</aop:config>

</beans>
